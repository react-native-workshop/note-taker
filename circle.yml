general:
  artifacts:
    - "android/app/build/outputs/apk/app-release.apk"
machine:
  java:
      version: oraclejdk8

dependencies:
  pre:
    - cd ${HOME} && wget http://dl.google.com/android/android-sdk_r24.2-linux.tgz
    - tar -xvf android-sdk_r24.2-linux.tgz
    - export PATH="${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin:$ANDROID_HOME/tools/bin:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools"
    - export ANDROID_HOME="${HOME}/android-sdk-linux"
    - export ANDROID_SDK_HOME="${HOME}/android-sdk-linux"
    - export ANDROID_SDK_ROOT="${HOME}/android-sdk-linux"
    - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh | bash
    - nvm install 8.1.4
    - echo y | sdkmanager "platforms;android-23"
    - echo y | sdkmanager "build-tools;23.0.1"
    - echo y | sdkmanager "add-ons;addon-google_apis-google-23"
    - echo y | sdkmanager "extras;google;google_play_services"
    - echo y | sdkmanager "extras;google;m2repository"
    - echo y | sdkmanager "extras;android;m2repository"
  override:
    # Install node modules
    - yarn
  cache_directories:
    - node_modules
test:
  override:
    - yarn lint
    - yarn test && cat ./coverage/lcov.info | ./node_modules/.bin/codacy-coverage
deployment:
  staging:
    branch: [master, chapter-5]
    commands:
      # Build the APK
      - BUILD_NAME=$CIRCLE_BUILD_NUM BUILD_NUMBER=$CIRCLE_BUILD_NUM npm run build:android
